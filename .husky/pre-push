# Pre-push hook - runs full validation before pushing to remote
# This catches issues before they reach CI, saving time and resources

echo "ğŸ” Running pre-push checks..."

# Get the current branch
current_branch=$(git branch --show-current)

# Check if pushing to main directly
if [ "$current_branch" = "main" ]; then
  echo "âš ï¸  Warning: Pushing directly to main branch"
  echo "   Consider using feature branches and PRs for better code review."
fi

# Run type checking
echo "ğŸ“ Type checking..."
npm run type-check || {
  echo "âŒ Type check failed. Fix errors before pushing."
  exit 1
}

# Run linting
echo "ğŸ” Linting..."
npm run lint || {
  echo "âŒ Lint check failed. Run 'npm run lint:fix' to auto-fix issues."
  exit 1
}

# Run tests
echo "ğŸ§ª Running tests..."
npm run test || {
  echo "âŒ Tests failed. Fix failing tests before pushing."
  exit 1
}

# Run build verification
echo "ğŸ—ï¸  Building..."
npm run build || {
  echo "âŒ Build failed. Fix build errors before pushing."
  exit 1
}

# Verify build artifacts
echo "âœ… Verifying build..."
npm run verify-build || {
  echo "âŒ Build verification failed. Check verify-build output."
  exit 1
}

echo "âœ… All pre-push checks passed!"
