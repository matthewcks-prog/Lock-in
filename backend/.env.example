# =============================================================================
# Lock-in Backend - Environment Variables Template
# =============================================================================
# SECURITY: This file is version-controlled. NEVER commit real secrets.
# SETUP: Copy this to .env and replace placeholder values with real credentials.
#
# AZURE RESOURCE GROUP: lock-in-dev (Australia East)
# Resources:
#   - Azure OpenAI:       lock-in-openai-dev
#   - Container App:      lock-in-backend
#   - Container Registry: lockinacr
#   - Key Vault:          lock-in-kv
#   - App Insights:       lock-in-backend-insights
#   - Log Analytics:      lock-in-backend-logs
#   - Container Env:      lock-in-env
# =============================================================================

# -----------------------------------------------------------------------------
# ENVIRONMENT SELECTION (REQUIRED)
# -----------------------------------------------------------------------------
# Controls which environment this instance runs in.
# Valid values: development | staging | production
# - development: Local dev, uses *_DEV Supabase vars
# - staging: Pre-prod testing, uses *_DEV Supabase vars
# - production: Live production, uses *_PROD Supabase vars
NODE_ENV=development

# -----------------------------------------------------------------------------
# DATABASE - Supabase (REQUIRED)
# -----------------------------------------------------------------------------
# ⚠️ CRITICAL: Set ONLY the variables for your target environment.
# - For local dev: Set *_DEV variables
# - For production: Set *_PROD variables
# - NEVER set both in the same .env file (isolation principle)

# Development/Staging Supabase (Project: uszxfuzauetcchwcgufe)
SUPABASE_URL_DEV=https://your-dev-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY_DEV=eyJhbGc...(dev-service-role-key)
SUPABASE_ANON_KEY_DEV=eyJhbGc...(dev-anon-key)

# Production Supabase (Project: vtuflatvllpldohhimao)
# ⚠️ ONLY set these in production deployment (Azure Container Apps env vars)
# SUPABASE_URL_PROD=https://your-prod-project.supabase.co
# SUPABASE_SERVICE_ROLE_KEY_PROD=eyJhbGc...(prod-service-role-key)
# SUPABASE_ANON_KEY_PROD=eyJhbGc...(prod-anon-key)

# -----------------------------------------------------------------------------
# AI PROVIDER - Azure OpenAI (REQUIRED)
# -----------------------------------------------------------------------------
# Primary AI provider. Get credentials from Azure Portal -> Azure OpenAI resource.
AZURE_OPENAI_API_KEY=your-azure-key-here
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-01

# Azure OpenAI deployment names (must match your Azure deployments)
AZURE_OPENAI_CHAT_DEPLOYMENT=gpt-4o-mini
AZURE_OPENAI_EMBEDDINGS_DEPLOYMENT=text-embedding-3-small
AZURE_OPENAI_TRANSCRIPTION_DEPLOYMENT=whisper-1

# -----------------------------------------------------------------------------
# AI PROVIDER - OpenAI Fallback (OPTIONAL)
# -----------------------------------------------------------------------------
# Fallback provider if Azure OpenAI fails. Get key from https://platform.openai.com/api-keys
# OPENAI_API_KEY=sk-proj-...
# OPENAI_FALLBACK_ENABLED=true
# OPENAI_MODEL=gpt-4o-mini
# OPENAI_EMBEDDINGS_MODEL=text-embedding-3-small
# OPENAI_TRANSCRIPTION_MODEL=whisper-1

# -----------------------------------------------------------------------------
# SERVER (OPTIONAL)
# -----------------------------------------------------------------------------
PORT=3000

# -----------------------------------------------------------------------------
# OBSERVABILITY - Sentry (OPTIONAL)
# -----------------------------------------------------------------------------
# Error tracking and monitoring. Get DSN from https://sentry.io
# SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx
# SENTRY_ENABLED=true

# -----------------------------------------------------------------------------
# OBSERVABILITY - Azure Application Insights (OPTIONAL, RECOMMENDED)
# -----------------------------------------------------------------------------
# Azure-native APM for request tracing, performance monitoring, and metrics.
# Get connection string from Azure Portal -> Application Insights -> Overview
# APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=xxx;IngestionEndpoint=https://xxx.in.applicationinsights.azure.com/

# -----------------------------------------------------------------------------
# OBSERVABILITY - Logging (OPTIONAL)
# -----------------------------------------------------------------------------
# Log level: debug, info, warn, error (default: info in production, debug in development)
# LOG_LEVEL=info

# -----------------------------------------------------------------------------
# RATE LIMITING (OPTIONAL)
# -----------------------------------------------------------------------------
# DAILY_REQUEST_LIMIT=100
# TRANSCRIPT_DAILY_JOB_LIMIT=20
# TRANSCRIPT_MAX_CONCURRENT_JOBS=3
# CHAT_LIST_LIMIT=20
# MAX_CHAT_LIST_LIMIT=100

# -----------------------------------------------------------------------------
# FILE UPLOADS (OPTIONAL)
# -----------------------------------------------------------------------------
# NOTE_ASSETS_BUCKET=note-assets
# NOTE_ASSETS_MAX_BYTES=10485760
# CHAT_ASSETS_BUCKET=chat-assets
# CHAT_ASSETS_MAX_BYTES=10485760
# CHAT_ASSET_DAILY_UPLOAD_LIMIT=50
# CHAT_ASSET_DAILY_UPLOAD_BYTES_LIMIT=104857600
# CHAT_ASSET_SIGNED_URL_TTL_SECONDS=600

# Maximum chat asset uploads per user per day (default: 50)
# CHAT_ASSET_DAILY_UPLOAD_LIMIT=50

# Maximum chat asset bytes per user per day (default: 100MB)
# CHAT_ASSET_DAILY_UPLOAD_BYTES_LIMIT=104857600

# -----------------------------------------------------------------------------
# OPTIONAL - Storage Buckets
# -----------------------------------------------------------------------------

# Supabase Storage bucket names
# NOTE_ASSETS_BUCKET=note-assets
# CHAT_ASSETS_BUCKET=chat-assets

# Signed URL expiration in seconds (default: 600 = 10 minutes)
# CHAT_ASSET_SIGNED_URL_TTL_SECONDS=600

# -----------------------------------------------------------------------------
# OPTIONAL - Transcription Service
# -----------------------------------------------------------------------------

# Transcription model (default: whisper-1)
# OPENAI_TRANSCRIPTION_MODEL=whisper-1

# Maximum segment size in MB (default: 24)
# TRANSCRIPTION_SEGMENT_MAX_MB=24

# Temp directory for transcription files (default: ./tmp/transcripts)
# TRANSCRIPTION_TEMP_DIR=/tmp/transcripts

# Maximum chunk size in bytes (default: 8MB)
# TRANSCRIPT_CHUNK_MAX_BYTES=8388608

# Maximum transcription jobs per user per day (default: 20)
# TRANSCRIPT_DAILY_JOB_LIMIT=20

# Maximum concurrent jobs per user (default: 3)
# TRANSCRIPT_MAX_CONCURRENT_JOBS=3

# Maximum file size for transcription in bytes (default: 512MB)
# TRANSCRIPT_MAX_TOTAL_BYTES=536870912

# Maximum video duration in minutes (default: 180 = 3 hours)
# TRANSCRIPT_MAX_DURATION_MINUTES=180

# Supabase Storage bucket for transcript job chunks (default: transcript-jobs)
# TRANSCRIPT_JOBS_BUCKET=transcript-jobs

# Maximum upload bytes per minute (default: 512MB)
# TRANSCRIPT_UPLOAD_BYTES_PER_MINUTE=536870912

# Job expiration time in minutes (default: 60)
# TRANSCRIPT_JOB_TTL_MINUTES=60

# Job reaper interval in minutes (default: 10)
# TRANSCRIPT_JOB_REAPER_INTERVAL_MINUTES=10

# Grace period before deleting uploaded transcript chunks after completion (default: 48 hours)
# TRANSCRIPT_CHUNK_RETENTION_HOURS=48

# Hard TTL for transcript chunks regardless of status (default: 7 days)
# TRANSCRIPT_CHUNK_HARD_TTL_DAYS=7

# Processing heartbeat interval in seconds (default: 30)
# TRANSCRIPT_PROCESSING_HEARTBEAT_INTERVAL_SECONDS=30

# Processing stale threshold in minutes (default: 5)
# TRANSCRIPT_PROCESSING_STALE_MINUTES=5
