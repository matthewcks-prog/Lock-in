# Prompt Log

Log of refactoring prompts and outcomes. Tracks major architectural changes and refactor-prep work.

| Prompt ID                            | Tool      | Mode | Purpose                            | Output Summary                                                                                                                                                                                                                                                                            | Date       |
| ------------------------------------ | --------- | ---- | ---------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------- |
| 2026-01-27-docs-root-cleanup         | Codex CLI | edit | Docs root cleanup + link integrity | Moved root-level docs into `docs/architecture/` and `docs/deployment/`, removed duplicate transcript/environment pointer docs, updated repo map/index/status references, and verified `npm run docs:check-links`.                                                                         | 2026-01-27 |
| 2026-01-27-phase5-docs-consolidation | Codex CLI | edit | Phase 5 docs consolidation + links | Moved root docs into `docs/reference/`, archived legacy audits under `docs/archive/`, consolidated environment guidance into `docs/deployment/ENVIRONMENTS.md`, sanitized env templates, added `docs:check-links` with CI enforcement, fixed broken links, and re-ran `npm run validate`. | 2026-01-27 |
| 2026-01-25-phase3-validate-gate      | Codex CLI | edit | Clear Phase 3 regression gate      | Formatted `backend/controllers/transcriptsController.js`, ran `npm run validate`, and marked Phase 3 regression checkbox complete.                                                                                                                                                        | 2026-01-25 |
| 2026-01-25-phase3-core-purity        | Codex CLI | edit | Phase 3 core purity + testability  | Removed DOM usage from core text utils, added injected fetch/logger support in API/auth + notes service, updated initApi/tests, and refreshed refactor tracking docs.                                                                                                                     | 2026-01-25 |
| 2026-01-25-phase2-upload-guards      | Codex CLI | edit | Phase 2 upload guards + tests      | Added server-side transcript chunk size guard, added upload rate-limit and oversize chunk tests, and updated refactor plan notes for Phase 2 large media handling.                                                                                                                        | 2026-01-25 |
| 2026-01-25-infra-env-params          | Codex CLI | edit | Parameterize infra env split       | Added staging/production parameters for resource groups and runtime identity IDs in `infrastructure/main.bicep`, updated deploy/validate scripts to accept overrides, and created the production RG (`lock-in-backend`) for future rollout.                                               | 2026-01-25 |
| 2026-01-25-runtime-identity-roles    | Codex CLI | edit | Tighten runtime identity scope     | Removed Contributor/AcrPush from the runtime managed identity, ensured AcrPull is scoped to ACR only, and enforced Key Vault secrets get/list on the runtime identity; updated setup script and refactor tracking notes.                                                                  | 2026-01-25 |
| 2026-01-25-cicd-env-verify           | Codex CLI | edit | Harden CI/CD envs + verification   | Added GitHub auth/admin checks and idempotent environment creation in `setup_uami.ps1`, bounded staging/production verification with timeouts and fail-fast FQDN validation, and updated workflow docs to reflect the new checks.                                                         | 2026-01-25 |
| 2026-01-25-oidc-cleanup              | Codex CLI | edit | OIDC cleanup + doc alignment       | Removed legacy SP-based setup scripts and duplicate Azure deployment doc, updated rollback workflow and CI/CD docs/scripts to OIDC managed identity, refreshed repo docs/links, and updated refactor tracking notes.                                                                      | 2026-01-25 |
| 2026-01-25-transcript-cache          | Codex CLI | edit | Add transcript caching endpoint    | Added backend transcript cache service/controller/route, API client + UI hook/context wiring, chat hook support for optional transcript caching, tests, and docs updates for transcript caching flow.                                                                                     | 2026-01-25 |
| 2026-01-24-transcript-storage-rls    | Codex CLI | edit | Add transcript storage RLS policy  | Added Supabase Storage RLS policies for 48h read access + owner-prefixed uploads in the transcript-jobs bucket, updated migration and docs to reflect the access window behavior.                                                                                                         | 2026-01-24 |
| 2026-01-24-phase2-durability         | Codex CLI | edit | Phase 2 durability + rate limits   | Replaced in-memory transcript job tracking/idempotency/upload rate limits with Supabase-backed tables + RPC, stored transcript chunks in Supabase Storage with cleanup/heartbeat recovery, switched chunk messaging to binary/backpressure, and updated docs/migrations.                  | 2026-01-24 |
| 2026-01-23-jsx-runtime-fix           | Codex CLI | edit | Fix extension JSX runtime mismatch | Forced Vite UI builds to align NODE_ENV/mode and set esbuild jsxDev per mode to prevent `jsxDEV is not a function` crashes in local dev builds.                                                                                                                                           | 2026-01-23 |
| 2026-01-23-phase1-transcripts        | Codex CLI | edit | Phase 1 transcript source-of-truth | Consolidated transcript extraction into core providers, added Html5Provider + Panopto helper exports, refactored background/panopto resolver/transcript handler to use provider registry, added tests, and updated docs.                                                                  | 2026-01-23 |
| 2026-01-23-refactor-plan-redesign    | Codex CLI | edit | Redesign refactor plan             | Rewrote refactor plan from 2026-01-23 audit, reflecting completed guardrails and remaining phased work across transcripts, scalability, purity, docs, and cohesion splits.                                                                                                                | 2026-01-23 |
| 2026-01-23-phase2-quality            | Codex CLI | edit | Phase 2 quality/testing/observ.    | Added coverage thresholds + CI enforcement, expanded notes/chat tests, and routed backend transcript/Sentry logs through structured logger.                                                                                                                                               | 2026-01-23 |
| 2026-01-23-doc-integrity-phase0-1    | Codex CLI | edit | Phase 0/1 documentation integrity  | Restored `docs/tracking/STATUS.md`, updated `docs/architecture/REPO_MAP.md`, and marked legacy transcript troubleshooting docs as non-canonical.                                                                                                                                          | 2026-01-23 |
| 2026-01-23-agents-guardrails         | Codex CLI | edit | Update AGENTS guardrails           | Added transcript source-of-truth, core purity, shared retry policy, no in-memory state, and docs placement/link integrity rules; updated refactor tracking docs.                                                                                                                          | 2026-01-23 |
| 2026-01-19-phase1-refactor           | Codex CLI | edit | Phase 1 structure + scalability    | Split notes editor/hooks/panel into focused modules, decomposed transcript providers/parsers/video detection, and updated refactor tracking docs.                                                                                                                                         | 2026-01-19 |
| 2026-01-19-quality-audit             | Codex CLI | edit | Audit + refactor plan refresh      | Updated refactor plan phases and created quality audit doc for current repo state.                                                                                                                                                                                                        | 2026-01-19 |
| 2026-01-18-phase0-refactor           | Codex CLI | edit | Phase 0 refactor plan completion   | Removed hardcoded extension Supabase keys via env-injected config build, added API response validation for notes/chats/assets, tightened storage typing, and updated docs.                                                                                                                | 2026-01-18 |
| 2026-01-17-azure-openai-fallback     | Codex CLI | edit | Azure OpenAI primary + fallback    | Added Azure OpenAI config/provider factory + retry/fallback wrapper, refactored openaiClient, updated env templates/docker/docs/scripts, and added backend check script + deps bump.                                                                                                      | 2026-01-17 |
| 2026-01-12-doc-first-pagination      | Codex CLI | edit | Document-first chat + pagination   | Enabled attachment-first chats, added cursor-based chat pagination with shared limits, implemented send dedup/retry/rate-limit feedback, and added backend/UI tests with doc updates.                                                                                                     | 2026-01-12 |
| 2026-01-12-doc-first-pagination-fix  | Codex CLI | edit | Stabilize tests + type-check       | Switched backend tests to require-based stubs, added test-only Node shims, tightened chat history typings, and disabled mutation-level retries to surface rate-limit errors promptly.                                                                                                     | 2026-01-12 |
| 2026-01-12-chat-sidebar-refactor     | Codex CLI | edit | Fix chat UI + sidebar refactor     | Fixed chat message cache + blank chat regression, added attachment upload with vision payload, extracted sidebar layout/tabs/chat/resize, and updated refactor docs.                                                                                                                      | 2026-01-12 |
| 2026-01-06-echo360-transcripts       | Codex CLI | edit | Add Echo360 transcript support     | Added Echo360 provider, detection, background wiring, provider bundle build step, tests, and doc updates.                                                                                                                                                                                 | 2026-01-06 |
| C1-import-hygiene                    | Codex     | edit | Normalize import paths             | Normalized `@core/*` and `@shared/ui` path aliases, removed deep relative imports.                                                                                                                                                                                                        | 2024-12    |
| C2-docs-scaffolds                    | Codex     | edit | Create documentation structure     | Created `docs/architecture/ARCHITECTURE.md`, `docs/architecture/REPO_MAP.md`, `docs/tracking/STATUS.md` for stable contracts and living snapshots.                                                                                                                                        | 2024-12    |
| C3-vite-dedupe                       | Codex     | edit | Deduplicate Vite configs           | Centralized shared Vite configuration, removed duplication.                                                                                                                                                                                                                               | 2024-12    |
| C4-api-layering                      | Codex     | edit | Layer API client architecture      | Layered API client into fetcher + resource clients, added contract guardrails, retry/abort/conflict/asset mapping tests, updated docs.                                                                                                                                                    | 2024-12    |
| C4C-1-content-runtime-v1             | Codex     | edit | Version content runtime            | Versioned `window.LockInContent` runtime, migrated helpers to canonical API, added surface test + ESLint guard.                                                                                                                                                                           | 2024-12    |
| C4C-2-remove-compat-shim             | Codex     | edit | Remove legacy compat               | Removed content runtime compat shim; ESLint guard now errors on legacy identifiers; surface tests enforce canonical-only keys.                                                                                                                                                            | 2024-12    |
| C5A-init-api-globals                 | Codex     | edit | Add init API contract tests        | Init API globals contract gate (initApi surface test covering `window.LockInAPI`/`window.LockInAuth` + compat aliases).                                                                                                                                                                   | 2024-12    |
| C5B-ui-globals                       | Codex     | edit | Add UI globals contract tests      | UI globals contract gate (LockInUI surface test covering keys + sidebar factory contract).                                                                                                                                                                                                | 2024-12    |
| C5C-manifest-order                   | Codex     | edit | Add manifest order guardrail       | Manifest content_scripts order guardrail (locks `content_scripts[0].js` sequence and critical ordering assertions).                                                                                                                                                                       | 2024-12    |
| C5D-init-order                       | Codex     | edit | Add init order guardrail           | Content bootstrap init-order guardrail (tests late UI/runtime availability and idempotent bootstrap to prevent race regressions).                                                                                                                                                         | 2024-12    |
| C5E-ci-gate                          | Codex     | edit | Add CI refactor gate               | CI refactor gate + local check script (GitHub Actions workflow runs lint → test → type-check → build → verify-build plus backend npm ci/test; root `npm run check` mirrors the gate).                                                                                                     | 2024-12    |
| 2026-01-04-transcript-error-handling | Codex     | edit | Improve transcript error handling  | Enhanced network request handling (30s timeout, 3 retries, comprehensive logging), improved error classification, created troubleshooting guide.                                                                                                                                          | 2026-01-04 |
| A3-readme-refresh                    | Cursor    | edit | README.md refresh (Phase A3)       | Added Notes/Transcripts/Feedback features to README, fixed SMOKE_CHECKLIST.md shortcut (Ctrl+Shift+L → Ctrl/Cmd + select).                                                                                                                                                                | 2026-01-11 |

## Notes

- **Codex steps (C1-C5E)**: Refactor-prep work focused on guardrails, documentation, tests, and build scripts
- **Phase B6**: Current phase focused on test hardening and lint noise reduction
- **All steps**: Documented in `docs/tracking/REFACTOR_PLAN.md` with completion status
- **Current status**: Tracked in `docs/tracking/STATUS.md`
