# Prompt Log

## How to use this doc

This document tracks all prompts used during the refactoring process. Each row represents a prompt session with its tool, mode, purpose, and outcomes. Use this to understand the sequence of work and reference previous analysis or decisions.

---

## Prompt History

| Prompt ID | Tool    | Mode      | Purpose                                | Output Summary                                                                                                                                                                                                                                                    | Date       |
| --------- | ------- | --------- | -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------- |
| P1        | Cursor  | Read-only | Baseline repo map / flows / risks      | [To be filled: Repository structure mapped, key flows identified, risks documented]                                                                                                                                                                               |            |
| P2        | Cursor  | Read-only | Tooling + guardrails audit             | [To be filled: Key findings: build configs, type coverage, test setup, lint rules status]                                                                                                                                                                         |            |
| P3A       | Cursor  | Edit      | Create refactor tracking docs          | Created docs/REFACTOR_PLAN.md and docs/PROMPT_LOG.md to track phased refactor preparation                                                                                                                                                                         |            |
| P3B       | Cursor  | Edit      | Rationalize AGENTS documentation       | AGENTS.md refactored to canonical stable contract; AGENTS.\_LIVINGDOC.md deprecated; docs hierarchy established; refactor prep tracking added                                                                                                                     |            |
| P3E2      | Cursor  | Edit      | extension/src vs libs structure change | P3 complete                                                                                                                                                                                                                                                       |            |
| P4        | Copilot | Edit      | Create smoke test checklist (B4)       | Created `docs/SMOKE_CHECKLIST.md` with 6 test sections covering build/load, selection→AI, notes CRUD, assets, session restore, popup; added debug tips; marked B4 complete in REFACTOR_PLAN.md                                                                    | 2024-12-14 |
| P5A       | Copilot | Edit      | ESLint baseline tooling (B5A)          | Added ESLint + TS plugins + import plugin; added `lint`/`lint:fix` scripts; created flat config with TS/TSX parsing and ignores for backend + build outputs; `npm run lint` runs (warnings only)                                                                  | 2025-12-14 |
| P5B       | Copilot | Edit      | Enforce arch boundaries (B5B)          | Added scoped ESLint overrides: ERROR if `/core` or `/api` use `chrome` or import from `extension/**`; WARN if `/ui` or `/extension` use deep relative imports into core/api/shared (prefer `@core/*`, `@api/*`, `@shared/ui*`); `npm run lint` runs with 0 errors | 2025-12-14 |
| P6A       | Cursor  | Edit      | Minimal unit test harness (B6A)        | Set up vitest test infrastructure: verified dev dependencies (vitest, @vitest/coverage-v8, jsdom) and test scripts already exist; created anchor tests: `core/utils/__tests__/textUtils.test.ts` (pure functions) and `integrations/adapters/__tests__/moodleAdapter.test.ts` (DOM-based); tests run fast, no network calls, no Chrome APIs; marked B6A complete in REFACTOR_PLAN.md | 2025-12-14 |
| C1        | Codex   | Edit      | Import hygiene + alias normalization    | Replaced extension notes deep imports with `@core/*`/`@shared/ui` aliases, added @shared/ui paths to tsconfig, added jsdom test stub for type-check, and refreshed AGENTS/REFACTOR_PLAN docs; lint, test, type-check, build, verify-build all passing | 2025-12-14 |
| C2        | Codex   | Docs-only | Create doc scaffolds                    | Added ARCHITECTURE (stable invariants), REPO_MAP (repo navigation), STATUS (living snapshot); updated AGENTS hierarchy plus refactor tracking (REFACTOR_PLAN, PROMPT_LOG) | 2025-12-14 |
| C3        | Codex   | Build-config refactor | Shared Vite config dedupe            | Added `build/viteShared.ts` with aliases/ascii-safe plugin/IIFE defaults; refactored `vite.config.ts`, `vite.config.initApi.ts`, `vite.config.contentLibs.ts` to reuse helpers without changing outputs; all guardrails (lint/test/type-check/build/verify-build) passing | 2025-12-14 |
| C4A       | Codex   | Plan      | API client layering plan (no runtime changes) | Cataloged all `createApiClient`/ApiClient usages (initApi bundling to `window.LockInAPI`, notesService, LockInSidebar, tests); grouped methods by resource (lockin, chats, notes, assets); proposed fetcher + resource client split with aggregator keeping identical public shape/behavior | 2025-12-16 |
| C4B-1     | Codex   | Edit      | Lock API client contract (tests-first) | Added Vitest contract/invariant tests for `createApiClient` surface keys, signature stability, retry backoff, conflict mapping, 204 handling, and abort semantics without changing runtime behavior | 2025-12-16 |
| C4B-2     | Codex   | Edit      | Split API client into fetcher/resources | Refactored `api/client.ts` into `api/fetcher.ts` plus resource clients (`lockinClient`, `chatsClient`, `notesClient`, `assetsClient`) while preserving identical public method bag and retry/abort/conflict/asset-mapping semantics; docs updated accordingly | 2025-12-16 |
| C4B-3     | Codex   | Edit      | API client regression traps + docs     | Added guardrail tests for note asset snake_case→camelCase mapping and If-Unmodified-Since/409 ConflictError semantics; refreshed STATUS with C4 changes/invariants and smoke checklist reminders; marked C4 complete in REFACTOR_PLAN.md | 2025-12-16 |
| C4C-1     | Codex   | Edit      | LockIn content runtime contract        | Added versioned window.LockInContent runtime (storage/messaging/session/logger + compat shims), migrated content helpers to canonical API, added surface test + ESLint guard, and ran lint/test/type-check/build/verify-build | 2025-12-16 |
| C4C-2     | Codex   | Edit      | Remove content runtime compat shim + enforce canonical contract | Removed legacy `Storage`/`MessageTypes` globals, tightened ESLint guard to error on compat usage, updated runtime surface tests to assert canonical-only keys and version, refreshed typings/docs/logs | 2025-12-16 |
| C5A       | Codex   | Edit      | Init API global contract tests         | Added Vitest surface test for initApi auto-init to lock `window.LockInAPI`/`window.LockInAuth` method bags and compat aliases using shared API client key fixture; stubbed chrome storage for jsdom; updated refactor docs/status | 2025-12-16 |
| C5B       | Codex   | Edit      | UI global contract test                | Added Vitest contract test `ui/extension/__tests__/uiSurface.test.ts` to lock `window.LockInUI` keys and the sidebar factory instance contract; refreshed refactor docs/status | 2025-12-16 |
| C5C       | Codex   | Edit      | Manifest content_scripts order guardrail | Added Vitest manifest order contract test locking `content_scripts[0].js` array and critical ordering (config first, initApi before contentLibs, ui before contentScript-react last); refreshed refactor docs/status | 2025-12-16 |
| AUDIT-1   | Cursor  | Read-only | Bulletproof Quality/Risk Audit                                    | Ran lint/test/type-check/build/verify-build; categorized 126 `any` lint warnings (quick fixes/medium refactors/danger zones); identified drift risks: missing contract tests for `window.LockInAPI/Auth/UI`, manifest script ordering, init order dependencies; produced prioritized backlog of 8 ROI improvements; updated STATUS.md with quality gates and known risks | 2025-12-16 |
| C5D       | Codex   | Edit      | Content bootstrap init-order guardrail  | Added Vitest suite `extension/src/__tests__/bootstrapInitOrder.test.ts` covering late UI availability, guarded bootstrap when content runtime is initially undefined, and idempotent double-triggering; updated refactor tracking docs and quality gates | 2025-12-16 |
| C5E       | Codex   | Edit      | CI refactor gate + local check script  | Added `refactor-gate` GitHub Actions workflow running npm ci → lint → test → type-check → build → verify-build plus backend npm ci/test; added root `npm run check` aggregator; refreshed refactor docs/status | 2025-12-16 |
| C5F       | Codex   | Edit      | Extension build output contract        | Moved UI/libs build outputs to extension/dist/**, updated Vite configs, manifest/background/popup references, tests, and docs to match the new contract | 2025-12-28 |
| C5G       | Codex   | Edit      | Build output banner guardrail          | Added generated-file banner to Vite IIFE outputs to discourage manual edits; wired transcript extraction UI into the sidebar and removed the header brand label | 2025-12-29 |
| C5H       | Codex   | Edit      | Chat history UI tests                  | Added component tests for chat history load/select/restore, aligned act usage with React 18, and documented refactor-prep test addition | 2025-12-30 |
