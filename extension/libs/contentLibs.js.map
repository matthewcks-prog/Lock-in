{"version":3,"file":"contentLibs.js","sources":["../src/logger.ts","../src/messaging.ts","../src/storage.ts","../../integrations/adapters/baseAdapter.ts","../../core/utils/textUtils.ts","../../integrations/adapters/moodleAdapter.ts","../../integrations/adapters/edstemAdapter.ts","../../integrations/index.ts","../src/contentLibs.ts"],"sourcesContent":["/**\r\n * Logger for Extension Content Scripts\r\n * \r\n * Provides structured logging with levels and consistent formatting.\r\n * Exposes window.LockInLogger for use by content scripts.\r\n * \r\n * This is bundled by vite.config.contentLibs.ts into extension/libs/\r\n */\r\n\r\nexport interface Logger {\r\n  debug: (...args: unknown[]) => void;\r\n  info: (...args: unknown[]) => void;\r\n  warn: (...args: unknown[]) => void;\r\n  error: (...args: unknown[]) => void;\r\n}\r\n\r\n/**\r\n * Configuration for logger\r\n * Can be controlled via window.LOCKIN_CONFIG.DEBUG\r\n */\r\nfunction isDebugEnabled(): boolean {\r\n  if (typeof window === \"undefined\") return false;\r\n  const config = (window as any).LOCKIN_CONFIG;\r\n  return config?.DEBUG === true || config?.DEBUG === \"true\";\r\n}\r\n\r\n/**\r\n * Create the logger instance\r\n */\r\nfunction createLogger(): Logger {\r\n  const PREFIX = \"[Lock-in]\";\r\n\r\n  return {\r\n    debug(...args: unknown[]) {\r\n      if (isDebugEnabled()) {\r\n        console.debug(PREFIX, ...args);\r\n      }\r\n    },\r\n\r\n    info(...args: unknown[]) {\r\n      console.info(PREFIX, ...args);\r\n    },\r\n\r\n    warn(...args: unknown[]) {\r\n      console.warn(PREFIX, ...args);\r\n    },\r\n\r\n    error(...args: unknown[]) {\r\n      console.error(PREFIX, ...args);\r\n    },\r\n  };\r\n}\r\n\r\n// Create and expose the logger\r\nconst logger = createLogger();\r\n\r\n// Expose globally for content scripts\r\nif (typeof window !== \"undefined\") {\r\n  (window as any).LockInLogger = logger;\r\n}\r\n\r\nexport { logger };\r\n","/**\r\n * Chrome Messaging Wrapper for Extension Content Scripts\r\n * \r\n * Provides type-safe messaging between content scripts, background script,\r\n * and other extension components.\r\n * Exposes window.LockInMessaging for use by content scripts.\r\n * \r\n * This is bundled by vite.config.contentLibs.ts into extension/libs/\r\n */\r\n\r\nexport interface Messaging {\r\n  /**\r\n   * Send a message to the background script\r\n   */\r\n  sendToBackground: <T = unknown>(message: unknown) => Promise<T>;\r\n\r\n  /**\r\n   * Listen for messages from background or other parts of extension\r\n   */\r\n  onMessage: (\r\n    callback: (message: unknown, sender: chrome.runtime.MessageSender) => unknown | Promise<unknown>\r\n  ) => () => void;\r\n\r\n  /**\r\n   * Send message to a specific tab\r\n   */\r\n  sendToTab: <T = unknown>(tabId: number, message: unknown) => Promise<T>;\r\n}\r\n\r\n/**\r\n * Create the messaging wrapper\r\n */\r\nfunction createMessaging(): Messaging {\r\n  return {\r\n    sendToBackground<T = unknown>(message: unknown): Promise<T> {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          chrome.runtime.sendMessage(message, (response: T) => {\r\n            if (chrome.runtime.lastError) {\r\n              reject(new Error(chrome.runtime.lastError.message));\r\n            } else {\r\n              resolve(response);\r\n            }\r\n          });\r\n        } catch (err) {\r\n          reject(err);\r\n        }\r\n      });\r\n    },\r\n\r\n    onMessage(\r\n      callback: (message: unknown, sender: chrome.runtime.MessageSender) => unknown | Promise<unknown>\r\n    ): () => void {\r\n      const listener = (\r\n        message: unknown,\r\n        sender: chrome.runtime.MessageSender,\r\n        sendResponse: (response?: unknown) => void\r\n      ): boolean | void => {\r\n        try {\r\n          const result = callback(message, sender);\r\n\r\n          if (result instanceof Promise) {\r\n            result\r\n              .then(sendResponse)\r\n              .catch((err: Error) => {\r\n                console.error(\"[Lock-in] Message handler error:\", err);\r\n                sendResponse({ error: err.message });\r\n              });\r\n            return true; // Keep channel open for async response\r\n          }\r\n\r\n          if (result !== undefined) {\r\n            sendResponse(result);\r\n          }\r\n        } catch (err) {\r\n          console.error(\"[Lock-in] Message handler error:\", err);\r\n          sendResponse({ error: err instanceof Error ? err.message : \"Unknown error\" });\r\n        }\r\n      };\r\n\r\n      chrome.runtime.onMessage.addListener(listener);\r\n\r\n      // Return unsubscribe function\r\n      return () => {\r\n        chrome.runtime.onMessage.removeListener(listener);\r\n      };\r\n    },\r\n\r\n    sendToTab<T = unknown>(tabId: number, message: unknown): Promise<T> {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          chrome.tabs.sendMessage(tabId, message, (response: T) => {\r\n            if (chrome.runtime.lastError) {\r\n              reject(new Error(chrome.runtime.lastError.message));\r\n            } else {\r\n              resolve(response);\r\n            }\r\n          });\r\n        } catch (err) {\r\n          reject(err);\r\n        }\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\n// Create and expose messaging\r\nconst messaging = createMessaging();\r\n\r\n// Expose globally for content scripts\r\nif (typeof window !== \"undefined\") {\r\n  (window as any).LockInMessaging = messaging;\r\n}\r\n\r\nexport { messaging };\r\n","/**\r\n * Chrome Storage Wrapper for Extension Content Scripts\r\n * \r\n * Provides storage abstraction with both sync and local storage support.\r\n * Exposes window.LockInStorage for use by content scripts.\r\n * \r\n * This is bundled by vite.config.contentLibs.ts into extension/libs/\r\n */\r\n\r\n/**\r\n * Storage keys used throughout the extension\r\n */\r\nexport const STORAGE_KEYS = {\r\n  SIDEBAR_IS_OPEN: \"lockin_sidebar_isOpen\",\r\n  SIDEBAR_ACTIVE_TAB: \"lockin_sidebar_activeTab\",\r\n  CURRENT_CHAT_ID: \"lockinCurrentChatId\",\r\n  ACTIVE_MODE: \"lockinActiveMode\",\r\n  MODE_PREFERENCE: \"modePreference\",\r\n  DEFAULT_MODE: \"defaultMode\",\r\n  LAST_USED_MODE: \"lastUsedMode\",\r\n  HIGHLIGHTING_ENABLED: \"highlightingEnabled\",\r\n  SELECTED_NOTE_ID: \"lockin_selectedNoteId\",\r\n} as const;\r\n\r\nexport type StorageKey = typeof STORAGE_KEYS[keyof typeof STORAGE_KEYS];\r\n\r\n/**\r\n * Storage change event\r\n */\r\nexport interface StorageChange {\r\n  oldValue?: unknown;\r\n  newValue?: unknown;\r\n}\r\n\r\n/**\r\n * Storage interface\r\n */\r\nexport interface Storage {\r\n  STORAGE_KEYS: typeof STORAGE_KEYS;\r\n  get: <T = unknown>(keys: string | string[]) => Promise<Record<string, T>>;\r\n  set: (data: Record<string, unknown>) => Promise<void>;\r\n  remove: (keys: string | string[]) => Promise<void>;\r\n  onChanged: (\r\n    callback: (changes: Record<string, StorageChange>, areaName: string) => void\r\n  ) => () => void;\r\n}\r\n\r\n/**\r\n * Create storage wrapper using chrome.storage.sync\r\n * (sync storage syncs across user's Chrome instances)\r\n */\r\nfunction createStorage(): Storage {\r\n  return {\r\n    STORAGE_KEYS,\r\n\r\n    get<T = unknown>(keys: string | string[]): Promise<Record<string, T>> {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          chrome.storage.sync.get(keys, (result) => {\r\n            if (chrome.runtime.lastError) {\r\n              reject(new Error(chrome.runtime.lastError.message));\r\n            } else {\r\n              resolve(result as Record<string, T>);\r\n            }\r\n          });\r\n        } catch (err) {\r\n          reject(err);\r\n        }\r\n      });\r\n    },\r\n\r\n    set(data: Record<string, unknown>): Promise<void> {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          chrome.storage.sync.set(data, () => {\r\n            if (chrome.runtime.lastError) {\r\n              reject(new Error(chrome.runtime.lastError.message));\r\n            } else {\r\n              resolve();\r\n            }\r\n          });\r\n        } catch (err) {\r\n          reject(err);\r\n        }\r\n      });\r\n    },\r\n\r\n    remove(keys: string | string[]): Promise<void> {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          chrome.storage.sync.remove(keys, () => {\r\n            if (chrome.runtime.lastError) {\r\n              reject(new Error(chrome.runtime.lastError.message));\r\n            } else {\r\n              resolve();\r\n            }\r\n          });\r\n        } catch (err) {\r\n          reject(err);\r\n        }\r\n      });\r\n    },\r\n\r\n    onChanged(\r\n      callback: (changes: Record<string, StorageChange>, areaName: string) => void\r\n    ): () => void {\r\n      const listener = (\r\n        changes: { [key: string]: chrome.storage.StorageChange },\r\n        areaName: string\r\n      ) => {\r\n        // Convert Chrome's StorageChange format to our interface format\r\n        const normalizedChanges: Record<string, StorageChange> = {};\r\n        for (const key in changes) {\r\n          normalizedChanges[key] = {\r\n            oldValue: changes[key].oldValue,\r\n            newValue: changes[key].newValue,\r\n          };\r\n        }\r\n        callback(normalizedChanges, areaName);\r\n      };\r\n\r\n      chrome.storage.onChanged.addListener(listener);\r\n\r\n      // Return unsubscribe function\r\n      return () => {\r\n        chrome.storage.onChanged.removeListener(listener);\r\n      };\r\n    },\r\n  };\r\n}\r\n\r\n// Create and expose storage\r\nconst storage = createStorage();\r\n\r\n// Expose globally for content scripts\r\nif (typeof window !== \"undefined\") {\r\n  (window as any).LockInStorage = storage;\r\n}\r\n\r\nexport { storage };\r\n","/**\r\n * Base Adapter Interface for Site-Specific Integrations\r\n * \r\n * Each supported site (Moodle, Edstem, etc.) implements this interface\r\n * to extract course context from the DOM.\r\n */\r\n\r\nimport type { CourseContext, PageContext } from \"../../core/domain/types\";\r\n\r\n/**\r\n * Base adapter interface that all site adapters must implement\r\n */\r\nexport interface BaseAdapter {\r\n  /**\r\n   * Check if this adapter can handle the given URL\r\n   */\r\n  canHandle(url: string): boolean;\r\n\r\n  /**\r\n   * Extract course code from the page DOM\r\n   */\r\n  getCourseCode(dom: Document): string | null;\r\n\r\n  /**\r\n   * Extract week number from the page DOM\r\n   */\r\n  getWeek(dom: Document): number | null;\r\n\r\n  /**\r\n   * Extract topic/title from the page DOM\r\n   */\r\n  getTopic(dom: Document): string | null;\r\n\r\n  /**\r\n   * Extract full course context from the page\r\n   */\r\n  getCourseContext(dom: Document, url: string): CourseContext;\r\n\r\n  /**\r\n   * Extract full page context (title, heading, course info)\r\n   */\r\n  getPageContext(dom: Document, url: string): PageContext;\r\n}\r\n\r\n/**\r\n * Generic adapter for unknown sites (fallback)\r\n */\r\nexport class GenericAdapter implements BaseAdapter {\r\n  canHandle(_url: string): boolean {\r\n    return true; // Fallback adapter handles everything\r\n  }\r\n\r\n  getCourseCode(_dom: Document): string | null {\r\n    return null;\r\n  }\r\n\r\n  getWeek(_dom: Document): number | null {\r\n    return null;\r\n  }\r\n\r\n  getTopic(dom: Document): string | null {\r\n    const heading = dom.querySelector(\"h1, h2\")?.textContent?.trim();\r\n    return heading || null;\r\n  }\r\n\r\n  getCourseContext(_dom: Document, url: string): CourseContext {\r\n    return {\r\n      courseCode: null,\r\n      sourceUrl: url,\r\n    };\r\n  }\r\n\r\n  getPageContext(dom: Document, url: string): PageContext {\r\n    const heading = dom.querySelector(\"h1, h2\")?.textContent?.trim() || dom.title;\r\n    return {\r\n      url,\r\n      title: dom.title,\r\n      heading,\r\n      courseContext: this.getCourseContext(dom, url),\r\n    };\r\n  }\r\n}\r\n","/**\r\n * Text Processing Utilities\r\n * \r\n * Pure utility functions for text manipulation - no dependencies.\r\n */\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n */\r\nexport function escapeHtml(text: string): string {\r\n  if (typeof text !== \"string\") return \"\";\r\n  const div = document.createElement(\"div\");\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Extract course code from text (e.g., \"FIT1045\" or \"MAT1830\")\r\n * Pattern: 3 uppercase letters followed by 4 digits\r\n */\r\nexport function extractCourseCodeFromText(text: string): string | null {\r\n  if (!text || typeof text !== \"string\") return null;\r\n  const match = text.match(/\\b([A-Z]{3}\\d{4})\\b/i);\r\n  return match ? match[1].toUpperCase() : null;\r\n}\r\n\r\n/**\r\n * Format timestamp for display\r\n */\r\nexport function formatTimestamp(timestamp: string | null | undefined): string {\r\n  if (!timestamp) return \"Just now\";\r\n\r\n  const date = new Date(timestamp);\r\n  if (Number.isNaN(date.getTime())) return \"\";\r\n\r\n  const diff = Date.now() - date.getTime();\r\n  const minutes = Math.floor(diff / 60000);\r\n\r\n  if (minutes < 60) {\r\n    return minutes <= 1 ? \"Just now\" : `${minutes} min ago`;\r\n  }\r\n\r\n  const hours = Math.floor(minutes / 60);\r\n  if (hours < 24) {\r\n    return `${hours} hr${hours > 1 ? \"s\" : \"\"} ago`;\r\n  }\r\n\r\n  return date.toLocaleDateString();\r\n}\r\n\r\n/**\r\n * Build fallback chat title from timestamp\r\n */\r\nexport function buildFallbackChatTitle(timestamp: string | null | undefined): string {\r\n  if (!timestamp) return \"Untitled chat\";\r\n\r\n  const date = new Date(timestamp);\r\n  if (Number.isNaN(date.getTime())) return \"Untitled chat\";\r\n\r\n  return `Chat from ${date.toISOString().split(\"T\")[0]}`;\r\n}\r\n","/**\r\n * Moodle Adapter for Monash University Learning Management System\r\n * \r\n * Extracts course codes and context from Moodle pages.\r\n */\r\n\r\nimport type { BaseAdapter } from \"./baseAdapter\";\r\nimport type { CourseContext, PageContext } from \"../../core/domain/types\";\r\nimport { extractCourseCodeFromText } from \"../../core/utils/textUtils\";\r\n\r\n/**\r\n * Moodle-specific adapter for learning.monash.edu\r\n */\r\nexport class MoodleAdapter implements BaseAdapter {\r\n  constructor() {}\r\n\r\n  canHandle(url: string): boolean {\r\n    return url.includes(\"learning.monash.edu\");\r\n  }\r\n\r\n  /**\r\n   * Get course code from page DOM\r\n   */\r\n  getCourseCode(dom: Document): string | null {\r\n    // Try multiple strategies to find course code\r\n    const candidateTexts: string[] = [];\r\n\r\n    // 1. Check meta tags\r\n    const metaSelectors = [\r\n      'meta[property=\"og:title\"]',\r\n      'meta[name=\"twitter:title\"]',\r\n      'meta[name=\"title\"]',\r\n    ];\r\n    metaSelectors.forEach((selector) => {\r\n      const content = dom.querySelector(selector)?.getAttribute(\"content\");\r\n      if (content) candidateTexts.push(content);\r\n    });\r\n\r\n    // 2. Check headings\r\n    const headingSelectors = [\r\n      \"h1\",\r\n      \"h2\",\r\n      \".page-header-headings\",\r\n      \".page-header-headings h1\",\r\n      \".course-title\",\r\n      \".breadcrumb\",\r\n      \"[data-region='course-header']\",\r\n    ];\r\n    headingSelectors.forEach((selector) => {\r\n      dom.querySelectorAll(selector).forEach((el) => {\r\n        const text = el.textContent?.trim();\r\n        if (text) candidateTexts.push(text);\r\n      });\r\n    });\r\n\r\n    // 3. Check body text (first 8000 chars)\r\n    const bodyText = dom.body?.innerText || \"\";\r\n    if (bodyText) {\r\n      candidateTexts.push(bodyText.substring(0, 8000));\r\n    }\r\n\r\n    // Try to extract course code from candidates\r\n    for (const text of candidateTexts) {\r\n      const code = extractCourseCodeFromText(text);\r\n      if (code) {\r\n        // Cache the mapping if we have a course ID\r\n        const courseId = this.getCourseId(dom);\r\n        if (courseId) {\r\n          this.persistCourseMapping(courseId, code);\r\n        }\r\n        return code;\r\n      }\r\n    }\r\n\r\n    // Fallback: check cached mapping\r\n    const courseId = this.getCourseId(dom);\r\n    if (courseId) {\r\n      return this.getStoredCourseMapping(courseId);\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Extract week number from Moodle page\r\n   * \r\n   * Looks for the \"Week X\" label that appears above topic headings on Moodle learning pages.\r\n   * Only returns a week if found in a specific, reliable location (not in general content).\r\n   */\r\n  getWeek(dom: Document): number | null {\r\n    // Pattern: \"Week 1\", \"Week 2\", etc. (case insensitive)\r\n    const weekPattern = /^\\s*Week\\s+(\\d{1,2})\\s*$/i;\r\n    \r\n    // First strategy: Look for a standalone \"Week X\" text element\r\n    // On Moodle, this appears as a separate element above the topic title\r\n    // It's often in a <strong> or standalone text near the section header\r\n    \r\n    // Check section info areas and headings - these should have ONLY \"Week X\"\r\n    const preciseSelectors = [\r\n      // Moodle section info region\r\n      '[data-region=\"section-info\"] .text-muted',\r\n      '[data-region=\"section-info\"]',\r\n      // Activity header area\r\n      '.activity-header .text-muted',\r\n      '.page-header-headings .text-muted',\r\n      // Breadcrumb might have it\r\n      '.breadcrumb-item.active',\r\n    ];\r\n    \r\n    for (const selector of preciseSelectors) {\r\n      const elements = dom.querySelectorAll(selector);\r\n      for (const el of elements) {\r\n        const text = el.textContent?.trim() || '';\r\n        const match = text.match(weekPattern);\r\n        if (match) {\r\n          const weekNum = parseInt(match[1], 10);\r\n          if (weekNum > 0 && weekNum <= 52) {\r\n            return weekNum;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Second strategy: Look for \"Week X\" as a small heading or label\r\n    // Check h2, h3, strong elements but only if they contain JUST \"Week X\"\r\n    const headingSelectors = ['h2', 'h3', 'h4', 'strong', '.section-title'];\r\n    \r\n    for (const selector of headingSelectors) {\r\n      const elements = dom.querySelectorAll(selector);\r\n      for (const el of elements) {\r\n        const text = el.textContent?.trim() || '';\r\n        // Only match if the element contains just \"Week X\" (possibly with whitespace)\r\n        const match = text.match(weekPattern);\r\n        if (match) {\r\n          const weekNum = parseInt(match[1], 10);\r\n          if (weekNum > 0 && weekNum <= 52) {\r\n            return weekNum;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Third strategy: Look for Week X at the very start of the main content\r\n    // The week label on Moodle pages is typically in the first 300 chars of section content\r\n    const sectionContent = dom.querySelector('.course-content .section, #region-main .content');\r\n    if (sectionContent) {\r\n      const text = (sectionContent.textContent || '').substring(0, 300);\r\n      // Look for \"Week X\" at the start of content (possibly after whitespace)\r\n      const startMatch = text.match(/^\\s*Week\\s+(\\d{1,2})\\b/i);\r\n      if (startMatch) {\r\n        const weekNum = parseInt(startMatch[1], 10);\r\n        if (weekNum > 0 && weekNum <= 52) {\r\n          return weekNum;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // No reliable week indicator found\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Extract topic/title from page\r\n   */\r\n  getTopic(dom: Document): string | null {\r\n    const heading = dom.querySelector(\"h1, h2\")?.textContent?.trim();\r\n    return heading || null;\r\n  }\r\n\r\n  /**\r\n   * Get course ID from URL query params\r\n   */\r\n  private getCourseId(dom: Document): string | null {\r\n    const url = new URL(dom.location.href);\r\n    return url.searchParams.get(\"id\");\r\n  }\r\n\r\n  /**\r\n   * Get stored course code mapping from localStorage\r\n   */\r\n  private getStoredCourseMapping(courseId: string): string | null {\r\n    try {\r\n      const raw = localStorage.getItem(\"lockin:monashCourseCodes\");\r\n      const mapping = raw ? JSON.parse(raw) : {};\r\n      return mapping[courseId] || null;\r\n    } catch (error) {\r\n      console.warn(\"Failed to read cached Monash course codes\", error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Persist course code mapping to localStorage\r\n   */\r\n  private persistCourseMapping(courseId: string, courseCode: string): void {\r\n    if (!courseId || !courseCode) return;\r\n\r\n    try {\r\n      const existing = this.getStoredCourseMapping(courseId)\r\n        ? JSON.parse(localStorage.getItem(\"lockin:monashCourseCodes\") || \"{}\")\r\n        : {};\r\n      \r\n      if (existing[courseId] === courseCode) return;\r\n\r\n      const next = { ...existing, [courseId]: courseCode };\r\n      localStorage.setItem(\"lockin:monashCourseCodes\", JSON.stringify(next));\r\n    } catch (error) {\r\n      console.warn(\"Failed to persist Monash course code\", error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get full course context\r\n   */\r\n  getCourseContext(dom: Document, url: string): CourseContext {\r\n    const courseCode = this.getCourseCode(dom);\r\n    const topic = this.getTopic(dom);\r\n    const week = this.getWeek(dom);\r\n\r\n    return {\r\n      courseCode,\r\n      courseName: courseCode || undefined,\r\n      week: week || undefined,\r\n      topic: topic || undefined,\r\n      sourceUrl: url,\r\n      sourceLabel: week ? `Week ${week}` : (topic || courseCode || undefined),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get full page context\r\n   */\r\n  getPageContext(dom: Document, url: string): PageContext {\r\n    const heading = dom.querySelector(\"h1, h2\")?.textContent?.trim() || dom.title;\r\n    const courseContext = this.getCourseContext(dom, url);\r\n\r\n    return {\r\n      url,\r\n      title: dom.title,\r\n      heading,\r\n      courseContext,\r\n    };\r\n  }\r\n}\r\n","/**\r\n * Edstem Adapter\r\n * \r\n * Extracts course context from Edstem pages.\r\n */\r\n\r\nimport type { BaseAdapter } from \"./baseAdapter\";\r\nimport type { CourseContext, PageContext } from \"../../core/domain/types\";\r\nimport { extractCourseCodeFromText } from \"../../core/utils/textUtils\";\r\n\r\n/**\r\n * Edstem-specific adapter\r\n */\r\nexport class EdstemAdapter implements BaseAdapter {\r\n  canHandle(url: string): boolean {\r\n    return url.includes(\"edstem.org\");\r\n  }\r\n\r\n  getCourseCode(dom: Document): string | null {\r\n    // Edstem course codes might be in:\r\n    // - Page title\r\n    // - Breadcrumbs\r\n    // - Course header\r\n    const title = dom.title;\r\n    const heading = dom.querySelector(\"h1\")?.textContent?.trim();\r\n    \r\n    const candidates = [title, heading].filter(Boolean);\r\n    for (const text of candidates) {\r\n      const code = extractCourseCodeFromText(text || \"\");\r\n      if (code) return code;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  getWeek(_dom: Document): number | null {\r\n    // TODO: Extract week from Edstem structure\r\n    return null;\r\n  }\r\n\r\n  getTopic(dom: Document): string | null {\r\n    const heading = dom.querySelector(\"h1, h2\")?.textContent?.trim();\r\n    return heading || null;\r\n  }\r\n\r\n  getCourseContext(dom: Document, url: string): CourseContext {\r\n    const courseCode = this.getCourseCode(dom);\r\n    const topic = this.getTopic(dom);\r\n\r\n    return {\r\n      courseCode,\r\n      topic: topic || undefined,\r\n      sourceUrl: url,\r\n      sourceLabel: topic || courseCode || undefined,\r\n    };\r\n  }\r\n\r\n  getPageContext(dom: Document, url: string): PageContext {\r\n    const heading = dom.querySelector(\"h1, h2\")?.textContent?.trim() || dom.title;\r\n    const courseContext = this.getCourseContext(dom, url);\r\n\r\n    return {\r\n      url,\r\n      title: dom.title,\r\n      heading,\r\n      courseContext,\r\n    };\r\n  }\r\n}\r\n","/**\r\n * Site Adapter Factory\r\n * \r\n * Selects the appropriate adapter based on the current URL.\r\n */\r\n\r\nimport type { BaseAdapter } from \"./adapters/baseAdapter\";\r\nimport { GenericAdapter } from \"./adapters/baseAdapter\";\r\nimport { MoodleAdapter } from \"./adapters/moodleAdapter\";\r\nimport { EdstemAdapter } from \"./adapters/edstemAdapter\";\r\n\r\n// Registry of all adapters (order matters - more specific first)\r\nconst adapters: BaseAdapter[] = [\r\n  new MoodleAdapter(),\r\n  new EdstemAdapter(),\r\n  new GenericAdapter(), // Fallback - must be last\r\n];\r\n\r\n/**\r\n * Get the appropriate adapter for the given URL\r\n */\r\nexport function getAdapterForUrl(url: string): BaseAdapter {\r\n  for (const adapter of adapters) {\r\n    if (adapter.canHandle(url)) {\r\n      return adapter;\r\n    }\r\n  }\r\n  // Should never reach here since GenericAdapter handles everything\r\n  return new GenericAdapter();\r\n}\r\n\r\n/**\r\n * Get adapter for current page\r\n */\r\nexport function getCurrentAdapter(): BaseAdapter {\r\n  if (typeof window === \"undefined\" || !window.location) {\r\n    return new GenericAdapter();\r\n  }\r\n  return getAdapterForUrl(window.location.href);\r\n}\r\n\r\n// Export adapter classes for direct use if needed\r\nexport { BaseAdapter, GenericAdapter, MoodleAdapter, EdstemAdapter };\r\n","/**\r\n * Content Script Libraries Entry Point\r\n * \r\n * This file bundles all the content script helper libraries and the page context\r\n * resolver with adapters. It serves as the single entry point for building\r\n * the content script dependencies.\r\n * \r\n * Bundled by vite.config.contentLibs.ts into extension/libs/contentLibs.js\r\n * \r\n * Exposes on window:\r\n * - LockInLogger\r\n * - LockInMessaging  \r\n * - LockInStorage\r\n * - LockInContent.resolveAdapterContext\r\n */\r\n\r\n// Import and re-export all libs (side effects expose them on window)\r\nimport \"./logger\";\r\nimport \"./messaging\";\r\nimport \"./storage\";\r\n\r\n// Import adapters and page context\r\nimport { getAdapterForUrl, GenericAdapter } from \"../../integrations\";\r\nimport type { BaseAdapter } from \"../../integrations/adapters/baseAdapter\";\r\nimport type { PageContext } from \"../../core/domain/types\";\r\n\r\n/**\r\n * Infer course code from URL or page content as fallback\r\n */\r\nfunction inferCourseCode(dom: Document, url: string): string | null {\r\n  // Try URL first\r\n  const urlMatch = url.match(/\\b([A-Z]{3}\\d{4})\\b/i);\r\n  if (urlMatch) {\r\n    return urlMatch[1].toUpperCase();\r\n  }\r\n\r\n  // Try page body text (expensive, do last)\r\n  const bodyText = dom.body?.innerText || \"\";\r\n  const codeMatch = bodyText.match(/\\b([A-Z]{3}\\d{4})\\b/i);\r\n  return codeMatch ? codeMatch[1].toUpperCase() : null;\r\n}\r\n\r\ninterface LoggerInterface {\r\n  error?: (...args: unknown[]) => void;\r\n  warn?: (...args: unknown[]) => void;\r\n  debug?: (...args: unknown[]) => void;\r\n}\r\n\r\n/**\r\n * Resolve the appropriate adapter for the current page and extract context\r\n */\r\nexport function resolveAdapterContext(logger?: LoggerInterface): {\r\n  adapter: BaseAdapter;\r\n  pageContext: PageContext;\r\n} {\r\n  const log = {\r\n    error: logger?.error ?? console.error,\r\n    warn: logger?.warn ?? console.warn,\r\n    debug: logger?.debug ?? (() => {}),\r\n  };\r\n\r\n  let adapter: BaseAdapter = new GenericAdapter();\r\n  let pageContext: PageContext = {\r\n    url: window.location.href,\r\n    title: document.title,\r\n    heading: document.title,\r\n    courseContext: { courseCode: null, sourceUrl: window.location.href },\r\n  };\r\n\r\n  try {\r\n    adapter = getAdapterForUrl(window.location.href) || adapter;\r\n    pageContext = adapter.getPageContext(document, window.location.href);\r\n\r\n    // Apply lightweight course-code inference if adapter didn't find one\r\n    const courseContext = pageContext.courseContext || {\r\n      courseCode: null,\r\n      sourceUrl: window.location.href,\r\n    };\r\n\r\n    if (!courseContext.courseCode) {\r\n      const inferred = inferCourseCode(document, window.location.href);\r\n      if (inferred) {\r\n        pageContext = {\r\n          ...pageContext,\r\n          courseContext: {\r\n            ...courseContext,\r\n            courseCode: inferred,\r\n          },\r\n        };\r\n      }\r\n    }\r\n  } catch (error) {\r\n    log.error(\"Failed to get page context:\", error);\r\n  }\r\n\r\n  return { adapter, pageContext };\r\n}\r\n\r\n// Expose to the content script orchestrator\r\nif (typeof window !== \"undefined\") {\r\n  (window as any).LockInContent = (window as any).LockInContent || {};\r\n  (window as any).LockInContent.resolveAdapterContext = resolveAdapterContext;\r\n}\r\n"],"names":["_a","courseId","logger"],"mappings":"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"}